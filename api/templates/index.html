<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>시간외근무자 급식비 계산 간소화 서비스</title>
    <style>
        body { font-family: 'Malgun Gothic', 'Apple SD Gothic Neo', sans-serif; max-width: 800px; margin: 20px auto; padding: 0 20px; line-height: 1.6; color: #333; }
        
        /* 버튼 그룹 및 공통 버튼 스타일 */
        .button-group { margin-bottom: 20px; padding: 20px; background: #f8f9fa; border-radius: 12px; border: 1px solid #eee; }
        
        button { 
            padding: 10px 20px; 
            margin-right: 8px; 
            cursor: pointer; 
            border-radius: 6px; 
            font-size: 14px; 
            font-weight: bold;
            transition: all 0.2s;
            border: 1px solid #ccc;
            background-color: #fff;
        }

        /* 강조 버튼 (파란색) */
        button.primary { 
            background-color: #007bff; 
            color: white; 
            border: none; 
        }
        button.primary:hover { background-color: #0056b3; }
        
        /* 일반 버튼 호버 */
        button:not(.primary):hover { background-color: #e2e6ea; border-color: #adb5bd; }

        #fileInfo { margin-top: 15px; font-size: 0.9em; color: #555; }

        /* 입력 폼 스타일 */
        fieldset { border: 1px solid #ddd; padding: 20px; border-radius: 12px; margin-bottom: 20px; background-color: #fff; }
        legend { padding: 0 10px; font-weight: bold; color: #007bff; }
        .form-group { margin-bottom: 12px; display: flex; align-items: center; }
        .form-group label { min-width: 100px; }
		.number-input { width: 80px; padding: 6px; text-align: center; border: 1px solid #ddd; border-radius: 4px; margin: 0 5px; }
        .time-input { width: 80px; padding: 6px; text-align: center; border: 1px solid #ddd; border-radius: 4px; margin: 0 5px; }

        /* 하단 안내 문구 */
        .notice { margin-top: 30px; border-top: 2px solid #eee; padding-top: 20px; }
        .notice h2, .notice h3 { color: #222; margin-bottom: 10px; }
        .notice ul { padding-left: 20px; }
        .notice li { margin-bottom: 5px; }
        .author { margin-top: 20px; font-weight: bold; color: #666; text-align: right; }
    </style>
</head>
<body>
    <h1>시간외근무자 급식비 계산 간소화 서비스</h1>
    
    <div class="button-group">
        <input type="file" id="excelFile" accept=".xls,.xlsx" style="display: none;" onchange="handleFileSelect(event)" />
        <button onclick="document.getElementById('excelFile').click()">파일 선택</button>
        <button class="primary" onclick="calculateMeal()">처리결과 다운로드</button>
        <button onclick="resetForm()">초기화</button>
        <div id="fileInfo">선택된 파일: 없음</div>
    </div>
    
    <fieldset>
		<legend>기본설정</legend>
		<div class="form-group">
			<label for="unitPrice">매식비 단가:</label>
			<input type="number" class="number-input" id="unitPrice" value="9000" step="1000"> 원
		</div>
	</fieldset>			
    <fieldset>		
        <legend>(선택사항) 휴일근무 시 급식비 미지급 조건</legend>
		<div class="form-group">
		<label for="minHours">최소수당시간:</label>
            <input type="text" class="number-input" id="minHours" value="60" /> 분
        </div>

        <div class="form-group">
            <label>미지급 시간 1:</label>
            <input type="text" class="time-input" id="startTime1" value="09:00" placeholder="출근"> ~
            <input type="text" class="time-input" id="endTime1" value="12:00" placeholder="퇴근">
        </div>

        <div class="form-group">
            <label>미지급 시간 2:</label>
            <input type="text" class="time-input" id="startTime2" value="13:00"> ~
            <input type="text" class="time-input" id="endTime2" value="18:00">
        </div>

        <div class="form-group">
            <label for="startTime3">미지급 시간 3:</label>
            <input type="text" class="time-input" id="startTime3" value="19:00"> 후
        </div>
		<p>※위 값은 예시이며, 미지급 시간은 <strong>00:00(24시간제)</strong> 형식으로 입력</p>	
                
        <p>※기본값에 대한 해석
		<br>- 휴일 수당시간이 1시간 미만일 경우 급식비 미지급
		<br>- 휴일 09시 이후 출근해 12시 이전 퇴근할 경우 급식비 미지급
		<br>- 휴일 13시 이후 출근해 18시 이전 퇴근할 경우 급식비 미지급
		<br>- 휴일 19시 이후 출근한 경우 급식비 미지급</p>	
    </fieldset>

    <div class="notice">
        <h2>사용법</h2>
        <ul>
            <li>[파일선택] 단추를 눌러 인사랑에서 추출한 파일 선택</li>
			<li>[처리결과 다운로드] 단추를 눌러 처리결과 다운로드</li>
        </ul>
		
        <h3>주의사항</h3>
        <ul>
            <li>인사랑에서 추출한 엑셀 파일을 그대로 업로드해 주시기 바랍니다.</li>       
		</ul>
        
        <h3>주요 기능</h3>
        <ul>
            <li>일자별 급식가부 판단 및 급식비 계산</li>
            <li>개인별 급식일수 및 급식비 집계</li>
            <li>개인별 급식일자 집계</li>    
        </ul>
        <div class="author">제공: 태성용(2175)</div>
    </div>

    <script>
        // 기존 스크립트 로직 동일 유지 (생략)
        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                document.getElementById('fileInfo').textContent = `선택된 파일: ${file.name}`;
            }
        }

        async function calculateMeal() {
			const fileInput = document.getElementById('excelFile');
			const file = fileInput.files[0];
			if (!file) { alert('파일을 선택해주세요.'); return; }

			const formData = new FormData();
			formData.append('file', file);
			formData.append('minHours', document.getElementById('minHours').value);
			
			// 시간 값들을 텍스트 그대로 전송
			formData.append('startTime1', document.getElementById('startTime1').value);
			formData.append('endTime1', document.getElementById('endTime1').value);
			formData.append('startTime2', document.getElementById('startTime2').value);
			formData.append('endTime2', document.getElementById('endTime2').value);
			formData.append('startTime3', document.getElementById('startTime3').value);
			formData.append('unitPrice', document.getElementById('unitPrice').value);

			try {
				const btn = document.querySelector('.primary');
				btn.disabled = true;
				btn.textContent = '처리 중...';

				const response = await fetch('/upload', { method: 'POST', body: formData });
				
				if (response.ok) {
					const blob = await response.blob();
					const url = window.URL.createObjectURL(blob);
					const a = document.createElement('a');
					a.href = url;
					a.click();
					alert('다운로드가 시작되었습니다.');
				} else {
					const err = await response.json();
					alert('오류: ' + err.error);
				}
			} catch (e) {
				alert('서버 연결 실패');
			} finally {
				const btn = document.querySelector('.primary');
				btn.disabled = false;
				btn.textContent = '처리결과 다운로드';
			}
		}

        function resetForm() {
            if(confirm('모든 설정을 초기화하시겠습니까?')) {
                location.reload();
            }
        }

        // 시간 입력 자동 콜론(:) 삽입
        document.querySelectorAll('.time-input').forEach(input => {
            input.addEventListener('input', function() {
                let v = this.value.replace(/\D/g, '');
                if (v.length >= 2) v = v.substring(0,2) + ':' + v.substring(2,4);
                this.value = v.substring(0, 5);
            });
        });
    </script>
</body>
</html>